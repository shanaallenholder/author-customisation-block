{"version":3,"sources":["@wordpress/components/src/ui/text/use-text.js"],"names":["hasNamespace","useContextSystem","css","cx","getFontSize","ui","isPlainObject","isNil","useMemo","Children","cloneElement","useTruncate","getOptimalTextShade","styles","createHighlighterText","useText","props","adjustLineHeightForInnerControls","align","children","className","color","ellipsizeMode","isDestructive","display","highlightEscape","highlightCaseSensitive","highlightWords","highlightSanitize","isBlock","letterSpacing","lineHeightProp","lineHeight","optimizeReadabilityFor","size","truncate","upperCase","variant","weight","get","otherProps","content","isHighlighter","Array","isArray","isCaption","autoEscape","caseSensitive","searchWords","sanitize","classes","sx","getLineHeight","Base","fontSize","fontWeight","textAlign","textTransform","optimalTextColor","isOptimalTextColorDark","Text","destructive","highlighterText","block","muted","finalEllipsizeMode","finalComponentProps","truncateProps","map","child","isLink","value","space"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { hasNamespace, useContextSystem } from '@wp-g2/context';\nimport { css, cx, getFontSize, ui } from '@wp-g2/styles';\nimport { isPlainObject, isNil } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useMemo, Children, cloneElement } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { useTruncate } from '../truncate';\nimport { getOptimalTextShade } from '../utils';\nimport * as styles from './styles';\nimport { createHighlighterText } from './utils';\n\n/**\n * @param {import('@wp-g2/create-styles').ViewOwnProps<import('./types').Props, 'span'>} props\n */\nexport default function useText( props ) {\n\tconst {\n\t\tadjustLineHeightForInnerControls,\n\t\talign,\n\t\tchildren,\n\t\tclassName,\n\t\tcolor,\n\t\tellipsizeMode,\n\t\tisDestructive = false,\n\t\tdisplay,\n\t\thighlightEscape = false,\n\t\thighlightCaseSensitive = false,\n\t\thighlightWords,\n\t\thighlightSanitize,\n\t\tisBlock = false,\n\t\tletterSpacing,\n\t\tlineHeight: lineHeightProp,\n\t\toptimizeReadabilityFor,\n\t\tsize,\n\t\ttruncate = false,\n\t\tupperCase = false,\n\t\tvariant,\n\t\tweight = ui.get( 'fontWeight' ),\n\t\t...otherProps\n\t} = useContextSystem( props, 'Text' );\n\n\t/** @type {import('react').ReactNode} */\n\tlet content = children;\n\tconst isHighlighter = Array.isArray( highlightWords );\n\tconst isCaption = size === 'caption';\n\n\tif ( isHighlighter ) {\n\t\tcontent = createHighlighterText( {\n\t\t\tautoEscape: highlightEscape,\n\t\t\t// Disable reason: We need to disable this otherwise it erases the cast\n\t\t\t// eslint-disable-next-line object-shorthand\n\t\t\tchildren: /** @type {string} */ ( children ),\n\t\t\tcaseSensitive: highlightCaseSensitive,\n\t\t\tsearchWords: highlightWords,\n\t\t\tsanitize: highlightSanitize,\n\t\t} );\n\t}\n\n\tconst classes = useMemo( () => {\n\t\tconst sx = {};\n\n\t\tconst lineHeight = getLineHeight( {\n\t\t\tlineHeight: lineHeightProp,\n\t\t\tadjustLineHeightForInnerControls,\n\t\t} );\n\n\t\tsx.Base = css( {\n\t\t\tcolor,\n\t\t\tdisplay,\n\t\t\tfontSize: getFontSize( size ),\n\t\t\t/* eslint-disable jsdoc/valid-types */\n\t\t\tfontWeight: /** @type {import('react').CSSProperties['fontWeight']} */ ( weight ),\n\t\t\t/* eslint-enable jsdoc/valid-types */\n\t\t\tlineHeight,\n\t\t\tletterSpacing,\n\t\t\ttextAlign: align,\n\t\t} );\n\n\t\tsx.upperCase = css( { textTransform: 'uppercase' } );\n\n\t\tsx.optimalTextColor = null;\n\n\t\tif ( optimizeReadabilityFor ) {\n\t\t\tconst isOptimalTextColorDark =\n\t\t\t\tgetOptimalTextShade( optimizeReadabilityFor ) === 'dark';\n\n\t\t\tsx.optimalTextColor = isOptimalTextColorDark\n\t\t\t\t? css( { color: ui.get( 'black' ) } )\n\t\t\t\t: css( { color: ui.get( 'white' ) } );\n\t\t}\n\n\t\treturn cx(\n\t\t\tstyles.Text,\n\t\t\tsx.Base,\n\t\t\tsx.optimalTextColor,\n\t\t\tisDestructive && styles.destructive,\n\t\t\t!! isHighlighter && styles.highlighterText,\n\t\t\tisBlock && styles.block,\n\t\t\tisCaption && styles.muted,\n\t\t\tvariant && styles[ variant ],\n\t\t\tupperCase && sx.upperCase,\n\t\t\tclassName\n\t\t);\n\t}, [\n\t\tadjustLineHeightForInnerControls,\n\t\talign,\n\t\tclassName,\n\t\tcolor,\n\t\tdisplay,\n\t\tisBlock,\n\t\tisCaption,\n\t\tisDestructive,\n\t\tisHighlighter,\n\t\tletterSpacing,\n\t\tlineHeightProp,\n\t\toptimizeReadabilityFor,\n\t\tsize,\n\t\tupperCase,\n\t\tvariant,\n\t\tweight,\n\t] );\n\n\t/** @type {undefined | 'auto' | 'none'} */\n\tlet finalEllipsizeMode;\n\tif ( truncate === true ) {\n\t\tfinalEllipsizeMode = 'auto';\n\t}\n\tif ( truncate === false ) {\n\t\tfinalEllipsizeMode = 'none';\n\t}\n\n\tconst finalComponentProps = {\n\t\t...otherProps,\n\t\tclassName: classes,\n\t\tchildren,\n\t\tellipsizeMode: ellipsizeMode || finalEllipsizeMode,\n\t};\n\n\tconst truncateProps = useTruncate( finalComponentProps );\n\n\t/**\n\t * Enhance child `<Link />` components to inherit font size.\n\t */\n\tif ( ! truncate && Array.isArray( children ) ) {\n\t\tcontent = Children.map( children, ( child ) => {\n\t\t\t// @ts-ignore\n\t\t\tif ( ! isPlainObject( child ) || ! ( 'props' in child ) ) {\n\t\t\t\treturn child;\n\t\t\t}\n\n\t\t\tconst isLink = hasNamespace( child, [ 'Link' ] );\n\t\t\tif ( isLink ) {\n\t\t\t\treturn cloneElement( child, {\n\t\t\t\t\tsize: child.props.size || 'inherit',\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn child;\n\t\t} );\n\t}\n\n\treturn {\n\t\t...truncateProps,\n\t\tchildren: truncate ? truncateProps.children : content,\n\t};\n}\n\n/* eslint-disable jsdoc/valid-types */\n/**\n * @param {Object} props\n * @param {import('./types').Props['adjustLineHeightForInnerControls']} [props.adjustLineHeightForInnerControls]\n * @param {import('react').CSSProperties['lineHeight']} [props.lineHeight]\n */\n/* eslint-enable jsdoc/valid-types */\nfunction getLineHeight( { adjustLineHeightForInnerControls, lineHeight } ) {\n\tif ( ! isNil( lineHeight ) ) return lineHeight;\n\n\tif ( ! adjustLineHeightForInnerControls ) return;\n\n\tlet value = `calc(${ ui.get( 'controlHeight' ) } + ${ ui.space( 2 ) })`;\n\n\tswitch ( adjustLineHeightForInnerControls ) {\n\t\tcase 'large':\n\t\t\tvalue = `calc(${ ui.get( 'controlHeightLarge' ) } + ${ ui.space(\n\t\t\t\t2\n\t\t\t) })`;\n\t\t\tbreak;\n\t\tcase 'small':\n\t\t\tvalue = `calc(${ ui.get( 'controlHeightSmall' ) } + ${ ui.space(\n\t\t\t\t2\n\t\t\t) })`;\n\t\t\tbreak;\n\t\tcase 'xSmall':\n\t\t\tvalue = `calc(${ ui.get( 'controlHeightXSmall' ) } + ${ ui.space(\n\t\t\t\t2\n\t\t\t) })`;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\treturn value;\n}\n"]}